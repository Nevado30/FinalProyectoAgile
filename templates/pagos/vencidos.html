{% extends 'base.html' %}
{% block title %}Pagos vencidos{% endblock %}

{% block header %}
  <h1>Pagos vencidos</h1>
  <a class="btn" href="{% url 'pagos:pendientes' %}">Ver pendientes</a>
  <a class="btn" href="{% url 'pagos:lista' %}">Ver todos</a>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Persona</th>
            <th>Banco</th>
            <th>Cuota</th>
            <th>Venció</th>
            <th>Monto</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
        {% for p, monto_pen in pagos_ctx %}
          <tr>
            <td>{{ p.prestamo.persona.apellidos }}, {{ p.prestamo.persona.nombres }}</td>
            <td>{{ p.prestamo.banco }}</td>
            <td>{{ p.numero_cuota }}</td>
            <td>{{ p.fecha_vencimiento }}</td>
            <td>{{ p.monto }}</td>
            <td>
              {% if p.estado == 'Pendiente' %}
                <span class="badge badge-vencido">Vencido</span>
              {% elif p.estado == 'Pagado' %}
                <span class="badge badge-pagado">Pagado</span>
              {% else %}
                <span class="badge badge-pendiente">{{ p.estado }}</span>
              {% endif %}
            </td>
            <td>
              {% if p.estado != 'Pagado' %}
                <form method="post" action="{% url 'pagos:marcar_pagado' p.id_pago %}">
                  {% csrf_token %}
                  <input type="hidden" name="next" value="{{ request.get_full_path }}">
                  <input type="hidden" name="base" value="{{ base }}">
                  <input type="hidden" name="destino" value="{{ destino }}">
                  <button class="btn btn-success" type="submit">Marcar pagado ✓</button>
                </form>
              {% else %}
                <span class="badge badge-pagado">OK</span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="7">No hay pagos vencidos.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
